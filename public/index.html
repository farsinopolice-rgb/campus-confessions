<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Confessions</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #ff69b4 0%, #ff1493 25%, #ff69b4 50%, #ffb6c1 75%, #ffc0cb 100%);
            background-attachment: fixed;
            color: #fff;
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(255, 105, 180, 0.4) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 20, 147, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(255, 182, 193, 0.3) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        body::after {
            content: 'üíï üíñ üíó üíì üíù üíò üíû üíü üíï üíñ üíó üíì üíù üíò üíû üíü';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            font-size: 2.5rem;
            opacity: 0.15;
            pointer-events: none;
            z-index: -1;
            animation: floatHearts 30s linear infinite;
            white-space: pre-wrap;
            overflow: hidden;
        }

        @keyframes floatHearts {
            0% { transform: translateY(100vh) rotate(0deg); }
            100% { transform: translateY(-100vh) rotate(360deg); }
        }

        /* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .timeline {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255, 192, 203, 0.95);
            backdrop-filter: blur(10px);
            min-height: 100vh;
            border-left: 3px solid #ff69b4;
            border-right: 3px solid #ff1493;
            box-shadow: 0 0 30px rgba(255, 105, 180, 0.4);
        }

        /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .top-bar {
            position: sticky;
            top: 0;
            background: rgba(255, 182, 193, 0.9);
            backdrop-filter: blur(12px);
            z-index: 50;
            border-bottom: 2px solid #ff69b4;
        }
        .top-bar-inner {
            padding: 12px 16px;
        }
        .top-bar h1 {
            font-size: 1.25em;
            font-weight: 700;
        }
        .top-bar .subtitle {
            font-size: 0.8em;
            color: #8b0000;
            font-weight: 400;
        }

        /* Search Bar Styles */
        .search-container {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-left: auto;
            margin-right: 12px;
        }

        #nameLookup {
            padding: 6px 10px;
            border: 1px solid #ff69b4;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.8);
            color: #8b0000;
            font-size: 0.75em;
            outline: none;
            transition: all 0.15s;
            font-family: inherit;
            width: 220px;
        }

        #nameLookup:focus {
            border-color: #ff1493;
            background: rgba(255, 255, 255, 0.95);
        }

        #nameLookup::placeholder {
            color: #ff69b4;
        }

        .search-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid #ff69b4;
            border-radius: 12px;
            margin-top: 5px;
            z-index: 1000;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            animation: dropdownSlide 0.2s ease;
        }

        @keyframes dropdownSlide {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .search-options {
            padding: 8px;
        }

        .search-option {
            width: 100%;
            padding: 10px 12px;
            border: none;
            background: none;
            cursor: pointer;
            transition: all 0.15s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: inherit;
            font-size: 0.85em;
            color: #8b0000;
            border-radius: 8px;
            text-align: left;
        }

        .search-option:hover {
            background: rgba(255, 105, 180, 0.15);
            transform: translateX(2px);
        }

        .search-option-icon {
            font-size: 1.1em;
            width: 20px;
            text-align: center;
        }

        .search-btn {
            padding: 6px 8px;
            background: rgba(255, 105, 180, 0.3);
            color: #8b0000;
            border: 1px solid #ff69b4;
            border-radius: 16px;
            font-size: 0.75em;
            cursor: pointer;
            transition: all 0.15s;
            font-family: inherit;
        }

        .search-btn:hover {
            background: rgba(255, 105, 180, 0.5);
            border-color: #ff1493;
        }

        /* Dark Mode Search Styles */
        body.dark-mode #nameLookup {
            background: rgba(30, 30, 40, 0.8);
            color: #ffb6c1;
            border-color: #ff69b4;
        }

        body.dark-mode #nameLookup:focus {
            background: rgba(30, 30, 40, 0.95);
            border-color: #ff1493;
        }

        body.dark-mode #nameLookup::placeholder {
            color: #ff69b4;
        }

        body.dark-mode .search-dropdown {
            background: rgba(20, 20, 30, 0.95);
            border-color: #ff1493;
        }

        body.dark-mode .search-option {
            color: #ffb6c1;
        }

        body.dark-mode .search-option:hover {
            background: rgba(255, 105, 180, 0.1);
        }

        body.dark-mode .search-btn {
            background: rgba(255, 105, 180, 0.2);
            color: #ffb6c1;
            border-color: #ff69b4;
        }

        body.dark-mode .search-btn:hover {
            background: rgba(255, 105, 180, 0.3);
            border-color: #ff1493;
        }

        /* Dark Mode Toggle */
        .dark-mode-toggle {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2em;
            padding: 4px 8px;
            border-radius: 20px;
            transition: all 0.3s;
        }
        .dark-mode-toggle:hover {
            background: rgba(255, 105, 180, 0.2);
        }

        /* Dark Mode Styles */
        body.dark-mode {
            background: linear-gradient(135deg, #1a0a0a 0%, #2d0a0a 25%, #1a0a0a 50%, #330a0a 75%, #1a0a0a 100%);
            color: #ffb6c1;
        }

        body.dark-mode::before {
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(255, 105, 180, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 20, 147, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(255, 182, 193, 0.1) 0%, transparent 50%);
        }

        body.dark-mode .timeline {
            background: rgba(20, 20, 30, 0.95);
            border-left: 3px solid #ff1493;
            border-right: 3px solid #ff69b4;
            box-shadow: 0 0 30px rgba(255, 105, 180, 0.2);
        }

        body.dark-mode .top-bar {
            background: rgba(20, 20, 30, 0.9);
            border-bottom: 2px solid #ff1493;
        }

        body.dark-mode .top-bar .subtitle {
            color: #ffb6c1;
        }

        body.dark-mode .compose textarea {
            color: #ffb6c1;
            background: rgba(30, 30, 40, 0.8);
            border: 1px solid rgba(255, 105, 180, 0.3);
        }

        body.dark-mode .compose textarea::placeholder {
            color: #ff69b4;
        }

        body.dark-mode .mood-chip {
            background: rgba(255, 105, 180, 0.15);
            border-color: #ff69b4;
            color: #ffb6c1;
        }

        body.dark-mode .mood-chip:hover {
            background: rgba(255, 105, 180, 0.3);
        }

        body.dark-mode .post-text {
            color: #ffb6c1;
        }

        body.dark-mode .post-handle,
        body.dark-mode .post-dot,
        body.dark-mode .post-time {
            color: #ff69b4;
        }

        body.dark-mode .reply-text {
            color: #ffb6c1;
        }

        body.dark-mode .reply-handle,
        body.dark-mode .reply-time {
            color: #ff69b4;
        }

        body.dark-mode .reply-compose input {
            color: #ffb6c1;
            background: rgba(30, 30, 40, 0.8);
            border-color: #ff69b4;
        }

        body.dark-mode .reply-compose input::placeholder {
            color: #ff69b4;
        }

        body.dark-mode .char-text {
            color: #ffb6c1;
        }

        body.dark-mode .action {
            color: #ffb6c1;
        }

        body.dark-mode .emoji-btn {
            background: rgba(255, 105, 180, 0.15);
            border-color: #ff69b4;
            color: #ffb6c1;
        }

        body.dark-mode .image-upload-btn,
        body.dark-mode .reply-image-btn {
            background: rgba(255, 105, 180, 0.2);
            color: #ffb6c1;
            border-color: #ff69b4;
        }

        body.dark-mode .image-upload-btn:hover,
        body.dark-mode .reply-image-btn:hover {
            background: rgba(255, 105, 180, 0.3);
            border-color: #ff1493;
        }

        body.dark-mode .empty {
            color: #ff69b4;
        }

        body.dark-mode .empty b {
            color: #ff1493;
        }

        body.dark-mode #nameLookup {
            background: rgba(30, 30, 40, 0.8);
            color: #ffb6c1;
            border-color: #ff69b4;
        }

        body.dark-mode #nameLookup:focus {
            background: rgba(30, 30, 40, 0.95);
            border-color: #ff1493;
        }

        body.dark-mode #nameLookup::placeholder {
            color: #ff69b4;
        }

        body.dark-mode .search-btn {
            background: rgba(255, 105, 180, 0.2);
            color: #ffb6c1;
            border-color: #ff69b4;
        }

        body.dark-mode .search-btn:hover {
            background: rgba(255, 105, 180, 0.3);
            border-color: #ff1493;
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            top: 0;
            left: -280px;
            width: 280px;
            height: 100vh;
            background: rgba(255, 192, 203, 0.95);
            backdrop-filter: blur(10px);
            border-right: 3px solid #ff69b4;
            transition: left 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .sidebar.open {
            left: 0;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #ff69b4;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .profile-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid #ff69b4;
            flex-shrink: 0;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-info h3 {
            margin: 0;
            font-size: 1.1em;
            color: #8b0000;
            font-weight: 700;
        }

        .profile-info p {
            margin: 4px 0 0 0;
            font-size: 0.9em;
            color: #ff69b4;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .sidebar-item {
            width: 100%;
            padding: 15px 20px;
            border: none;
            background: none;
            text-align: left;
            cursor: pointer;
            transition: all 0.15s;
            display: flex;
            align-items: center;
            gap: 12px;
            font-family: inherit;
            font-size: 0.9em;
            color: #8b0000;
        }

        .sidebar-item:hover {
            background: rgba(255, 105, 180, 0.2);
        }

        .sidebar-icon {
            font-size: 1.2em;
            width: 24px;
            text-align: center;
        }

        .sidebar-divider {
            height: 1px;
            background: #ff69b4;
            margin: 10px 20px;
        }

        .logout-btn {
            color: #ff1493;
            font-weight: 600;
        }

        .logout-btn:hover {
            background: rgba(255, 20, 147, 0.2);
        }

        .sidebar-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            background: rgba(255, 105, 180, 0.9);
            border: 2px solid #ff69b4;
            border-radius: 8px;
            cursor: pointer;
            z-index: 999;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            transition: all 0.15s;
        }

        .sidebar-toggle:hover {
            background: rgba(255, 105, 180, 1);
            transform: scale(1.05);
        }

        .sidebar.open + .sidebar-toggle {
            left: 300px;
        }

        /* Dark Mode Sidebar Styles */
        body.dark-mode .sidebar {
            background: rgba(20, 20, 30, 0.95);
            border-right-color: #ff1493;
        }

        body.dark-mode .profile-info h3 {
            color: #ffb6c1;
        }

        body.dark-mode .profile-info p {
            color: #ff69b4;
        }

        body.dark-mode .sidebar-item {
            color: #ffb6c1;
        }

        body.dark-mode .sidebar-item:hover {
            background: rgba(255, 105, 180, 0.15);
        }

        body.dark-mode .sidebar-divider {
            background: #ff1493;
        }

        body.dark-mode .sidebar-toggle {
            background: rgba(255, 105, 180, 0.8);
            border-color: #ff1493;
        }

        /* Report Button Styles */
        .report-container {
            position: relative;
            display: inline-block;
            margin-left: auto;
        }

        .report-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px 6px;
            border-radius: 12px;
            transition: all 0.15s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .report-btn:hover {
            background: rgba(255, 105, 180, 0.1);
            transform: scale(1.1);
        }

        .report-icon {
            font-size: 0.9em;
            opacity: 0.7;
            transition: opacity 0.15s;
        }

        .report-btn:hover .report-icon {
            opacity: 1;
        }

        .reply-report-btn {
            margin-top: 4px;
            padding: 2px 4px;
            font-size: 0.8em;
        }

        /* Report Tooltip Styles */
        .report-tooltip {
            position: absolute;
            top: 100%;
            right: 0;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            transform: translateY(-10px);
            margin-top: 5px;
        }

        .report-tooltip.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .report-tooltip-content {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid #ff69b4;
            border-radius: 12px;
            padding: 12px;
            min-width: 200px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
        }

        .report-tooltip-content h4 {
            margin: 0 0 10px 0;
            color: #8b0000;
            font-size: 0.9em;
            font-weight: 600;
            text-align: center;
        }

        .report-options {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 12px;
        }

        .report-options button {
            background: rgba(255, 105, 180, 0.1);
            border: 1px solid #ff69b4;
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.15s;
            font-family: inherit;
            font-size: 0.85em;
            color: #8b0000;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .report-options button:hover {
            background: rgba(255, 105, 180, 0.2);
            border-color: #ff1493;
            transform: translateY(-1px);
        }

        .report-custom-section {
            border-top: 1px solid #ff69b4;
            padding-top: 12px;
            margin-top: 8px;
        }

        .report-custom-section textarea {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            border: 1px solid #ff69b4;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #8b0000;
            font-family: inherit;
            font-size: 0.85em;
            resize: vertical;
            outline: none;
            transition: all 0.15s;
        }

        .report-custom-section textarea:focus {
            border-color: #ff1493;
            background: rgba(255, 255, 255, 0.95);
        }

        .report-custom-section textarea::placeholder {
            color: #ff69b4;
            font-style: italic;
        }

        .report-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            justify-content: flex-end;
        }

        .report-cancel-btn {
            background: rgba(255, 255, 255, 0.8);
            color: #8b0000;
            border: 1px solid #ff69b4;
            border-radius: 6px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.15s;
            font-family: inherit;
        }

        .report-cancel-btn:hover {
            background: rgba(255, 105, 180, 0.1);
            border-color: #ff1493;
        }

        .report-submit-btn {
            background: #ff69b4;
            color: #fff;
            border: 1px solid #ff1493;
            border-radius: 6px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: 600;
            transition: all 0.15s;
            font-family: inherit;
        }

        .report-submit-btn:hover {
            background: #ff1493;
            border-color: #e0146d;
            transform: translateY(-1px);
        }

        .report-submit-btn:disabled {
            background: #ccc;
            border-color: #999;
            cursor: not-allowed;
            transform: none;
        }

        /* Dark Mode Enhanced Report Styles */
        body.dark-mode .report-custom-section {
            border-color: #ff1493;
        }

        body.dark-mode .report-custom-section textarea {
            background: rgba(30, 30, 40, 0.9);
            color: #ffb6c1;
            border-color: #ff1493;
        }

        body.dark-mode .report-custom-section textarea:focus {
            background: rgba(30, 30, 40, 0.95);
            border-color: #ff69b4;
        }

        body.dark-mode .report-custom-section textarea::placeholder {
            color: #ff69b4;
        }

        body.dark-mode .report-cancel-btn {
            background: rgba(30, 30, 40, 0.8);
            color: #ffb6c1;
            border-color: #ff1493;
        }

        body.dark-mode .report-cancel-btn:hover {
            background: rgba(255, 105, 180, 0.1);
            border-color: #ff69b4;
        }

        body.dark-mode .report-submit-btn {
            background: #ff1493;
            border-color: #ff69b4;
        }

        body.dark-mode .report-submit-btn:hover {
            background: #ff69b4;
            border-color: #e0146d;
        }

        /* Dark Mode Report Styles */
        body.dark-mode .report-tooltip-content {
            background: rgba(20, 20, 30, 0.95);
            border-color: #ff1493;
        }

        body.dark-mode .report-tooltip-content h4 {
            color: #ffb6c1;
        }

        body.dark-mode .report-options button {
            background: rgba(255, 105, 180, 0.1);
            border-color: #ff1493;
            color: #ffb6c1;
        }

        body.dark-mode .report-options button:hover {
            background: rgba(255, 105, 180, 0.2);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .sidebar {
                width: 250px;
                left: -250px;
            }
            
            .sidebar.open + .sidebar-toggle {
                left: 270px;
            }
            
            .sidebar-header {
                padding: 15px;
            }
            
            .profile-avatar {
                width: 50px;
                height: 50px;
            }
            
            .sidebar-toggle {
                top: 15px;
                left: 15px;
                width: 35px;
                height: 35px;
                font-size: 1em;
            }
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 2px solid #ff1493;
        }
        .tab {
            flex: 1;
            text-align: center;
            padding: 10px 4px;
            font-size: 0.75em;
            font-weight: 500;
            color: #fff;
            cursor: pointer;
            position: relative;
            transition: background 0.2s;
            border: none;
            background: none;
            font-family: inherit;
        }
        .tab:hover { background: rgba(255, 105, 180, 0.3); }
        .tab.active { color: #fff; font-weight: 700; }
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 56px;
            height: 4px;
            background: #ff69b4;
            border-radius: 2px;
        }

        /* ‚îÄ‚îÄ Compose ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .compose {
            padding: 12px 16px;
            border-bottom: 2px solid #ff1493;
            display: flex;
            gap: 12px;
        }
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
            font-weight: 700;
            color: #fff;
        }
        .avatar.compose-avatar { background: #e0446d; }

        .compose-body { flex: 1; min-width: 0; }
        .compose textarea {
            width: 100%;
            border: none;
            outline: none;
            font-family: inherit;
            font-size: 1.15em;
            resize: none;
            min-height: 52px;
            color: #8b0000;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            padding: 8px;
            line-height: 1.4;
        }
        .compose textarea::placeholder { color: #ff69b4; }

        .compose-moods {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            padding: 8px 0 4px;
        }
        .mood-chip {
            padding: 3px 10px;
            border-radius: 14px;
            border: 1px solid #ff69b4;
            font-size: 0.78em;
            cursor: pointer;
            transition: all 0.15s;
            background: rgba(255, 105, 180, 0.2);
            color: #8b0000;
        }
        .mood-chip:hover { background: rgba(255, 105, 180, 0.4); }
        .mood-chip.selected {
            background: #fde8ee;
            border-color: #e0446d;
            color: #e0446d;
        }

        .compose-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 10px;
            border-top: 1px solid #ff69b4;
        }
        .compose-left { display: flex; align-items: center; gap: 12px; }

        /* Image Upload Styles */
        .image-upload-btn {
            padding: 6px 12px;
            background: rgba(255, 105, 180, 0.3);
            color: #8b0000;
            border: 1px solid #ff69b4;
            border-radius: 16px;
            font-size: 0.75em;
            cursor: pointer;
            transition: all 0.15s;
            font-family: inherit;
        }
        .image-upload-btn:hover { 
            background: rgba(255, 105, 180, 0.5);
            border-color: #ff1493;
        }

        .image-preview-container {
            margin: 8px 0;
        }

        .image-preview {
            position: relative;
            display: inline-block;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #ff69b4;
            max-width: 200px;
        }

        .image-preview img {
            width: 100%;
            height: auto;
            max-height: 200px;
            object-fit: cover;
            display: block;
        }

        .remove-image-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(255, 20, 147, 0.9);
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }
        .remove-image-btn:hover {
            background: rgba(255, 20, 147, 1);
            transform: scale(1.1);
        }

        /* Circular char counter */
        .char-ring {
            width: 28px;
            height: 28px;
            position: relative;
        }
        .char-ring svg { transform: rotate(-90deg); }
        .char-ring circle {
            fill: none;
            stroke-width: 2.5;
        }
        .char-ring .bg { stroke: #ff69b4; }
        .char-ring .fill { stroke: #e0446d; transition: stroke-dashoffset 0.2s, stroke 0.2s; }
        .char-ring .fill.warn { stroke: #ffc107; }
        .char-ring .fill.limit { stroke: #f44336; }
        .char-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%,-50%);
            font-size: 0.55em;
            color: #8b0000;
            font-weight: 600;
        }

        .post-btn {
            padding: 8px 20px;
            background: #e0446d;
            color: #fff;
            border: none;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.88em;
            cursor: pointer;
            transition: opacity 0.15s;
            font-family: inherit;
        }
        .post-btn:hover { opacity: 0.85; }
        .post-btn:disabled { opacity: 0.5; cursor: default; }

        /* ‚îÄ‚îÄ Post Card ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .post {
            display: flex;
            gap: 12px;
            padding: 12px 16px;
            border-bottom: 1px solid #ff69b4;
            transition: background 0.15s;
            animation: fadeIn 0.3s ease;
        }
        .post:hover { background: rgba(255, 105, 180, 0.1); }

        .post-body { flex: 1; min-width: 0; }

        .post-header {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 6px;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .post-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
        }

        .post-action-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px 6px;
            border-radius: 12px;
            transition: all 0.15s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
        }

        .delete-btn {
            color: #ff1493;
            opacity: 0.7;
        }

        .delete-btn:hover {
            background: rgba(255, 20, 147, 0.1);
            opacity: 1;
            transform: scale(1.1);
        }

        .delete-btn:active {
            transform: scale(0.95);
        }

        /* Dark Mode Post Actions */
        body.dark-mode .delete-btn {
            color: #ff69b4;
        }

        body.dark-mode .delete-btn:hover {
            background: rgba(255, 105, 180, 0.15);
        }

        .post-name {
            font-weight: 700;
            font-size: 0.92em;
        }
        .post-handle {
            color: #8b0000;
            font-size: 0.85em;
        }
        .post-dot {
            color: #8b0000;
            font-size: 0.7em;
        }
        .post-time {
            color: #8b0000;
            font-size: 0.85em;
        }

        .post-mood {
            display: inline-block;
            font-size: 0.73em;
            padding: 1px 8px;
            border-radius: 10px;
            margin-bottom: 4px;
            font-weight: 500;
        }
        .m-love { background: #fde8ee; color: #e0446d; }
        .m-happy { background: #fff8e1; color: #f9a825; }
        .m-sad { background: #e3f2fd; color: #1976d2; }
        .m-angry { background: #fbe9e7; color: #d84315; }
        .m-anxious { background: #f3e5f5; color: #8e24aa; }
        .m-excited { background: #e8f5e9; color: #2e7d32; }

        .post-text {
            font-size: 0.95em;
            line-height: 1.55;
            word-wrap: break-word;
            white-space: pre-wrap;
            color: #8b0000;
        }

        .post-image {
            margin: 8px 0;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #ff69b4;
            max-width: 100%;
        }

        .post-image img {
            width: 100%;
            height: auto;
            max-height: 400px;
            object-fit: cover;
            display: block;
        }

        /* Emoji reactions row (below text) */
        .post-reactions {
            display: flex;
            gap: 4px;
            margin-top: 8px;
            flex-wrap: wrap;
        }
        .emoji-btn {
            width: 32px;
            height: 28px;
            border-radius: 14px;
            border: 1px solid #ff69b4;
            background: rgba(255, 105, 180, 0.2);
            cursor: pointer;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2px;
            transition: all 0.15s;
            color: #8b0000;
        }
        .emoji-btn:hover { background: #fde8ee; border-color: #e0446d; transform: scale(1.1); }
        .emoji-btn.reacted { background: #fde8ee; border-color: #e0446d; }
        .emoji-btn .e-count {
            font-size: 0.7em;
            font-weight: 600;
        }

        /* Action bar (reply, repost, like, bookmark) */
        .actions {
            display: flex;
            justify-content: space-between;
            max-width: 400px;
            margin-top: 8px;
        }
        .action {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border-radius: 20px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 0.82em;
            color: #8b0000;
            transition: all 0.15s;
            font-family: inherit;
        }
        .action svg { width: 18px; height: 18px; fill: none; stroke: currentColor; stroke-width: 1.8; }
        .action:hover.reply-action { color: #ff69b4; background: rgba(255, 105, 180, 0.2); }
        .action:hover.repost-action { color: #ff1493; background: rgba(255, 20, 147, 0.2); }
        .action:hover.like-action { color: #ff1493; background: rgba(255, 20, 147, 0.2); }
        .action:hover.bookmark-action { color: #ff69b4; background: rgba(255, 105, 180, 0.2); }
        .action.liked { color: #f91880; }
        .action.liked svg { fill: #f91880; stroke: #f91880; }
        .action.reposted { color: #00ba7c; }
        .action.bookmarked { color: #1d9bf0; }
        .action.bookmarked svg { fill: #1d9bf0; }
        .action span { font-size: 0.95em; }

        /* ‚îÄ‚îÄ Replies ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .replies-section {
            display: none;
            padding: 0 0 8px;
        }
        .replies-section.open { display: block; }

        .reply {
            display: flex;
            gap: 10px;
            padding: 10px 0 10px 52px;
            border-top: 1px solid #ff69b4;
        }
        .reply-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #536471;
            color: #fff;
            font-size: 0.65em;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-weight: 700;
        }
        .reply-body { flex: 1; min-width: 0; }
        .reply-name { font-weight: 600; font-size: 0.82em; }
        .reply-handle { color: #8b0000; font-size: 0.78em; }
        .reply-text { font-size: 0.88em; line-height: 1.45; margin-top: 2px; color: #8b0000; }
        .reply-time { font-size: 0.72em; color: #8b0000; margin-top: 2px; }
        
        .reply-image {
            margin: 4px 0;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #ff69b4;
            max-width: 200px;
        }

        .reply-image img {
            width: 100%;
            height: auto;
            max-height: 150px;
            object-fit: cover;
            display: block;
        }

        .reply-compose {
            display: flex;
            gap: 10px;
            padding: 10px 0 4px 52px;
            border-top: 1px solid #ff69b4;
            align-items: center;
        }
        .reply-compose input {
            flex: 1;
            border: 1px solid #ff69b4;
            border-radius: 20px;
            padding: 8px 14px;
            font-size: 0.85em;
            outline: none;
            font-family: inherit;
            color: #8b0000;
            background: rgba(255, 255, 255, 0.8);
        }
        .reply-compose input:focus { border-color: #e0446d; }
        .reply-compose input::placeholder { color: #ff69b4; }
        
        .reply-image-btn {
            padding: 6px 8px;
            background: rgba(255, 105, 180, 0.3);
            color: #8b0000;
            border: 1px solid #ff69b4;
            border-radius: 16px;
            font-size: 0.75em;
            cursor: pointer;
            transition: all 0.15s;
            font-family: inherit;
        }
        .reply-image-btn:hover { 
            background: rgba(255, 105, 180, 0.5);
            border-color: #ff1493;
        }

        .reply-image-preview-container {
            margin: 8px 0 8px 52px;
        }

        .reply-image-preview {
            position: relative;
            display: inline-block;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #ff69b4;
            max-width: 150px;
        }

        .reply-image-preview img {
            width: 100%;
            height: auto;
            max-height: 150px;
            object-fit: cover;
            display: block;
        }

        .remove-reply-image-btn {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(255, 20, 147, 0.9);
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 10px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }
        .remove-reply-image-btn:hover {
            background: rgba(255, 20, 147, 1);
            transform: scale(1.1);
        }
        .reply-compose button {
            padding: 6px 16px;
            background: #e0446d;
            color: #fff;
            border: none;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.8em;
            cursor: pointer;
            font-family: inherit;
        }
        .reply-compose button:hover { opacity: 0.85; }

        /* ‚îÄ‚îÄ Empty State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .empty {
            text-align: center;
            padding: 80px 20px;
            color: #8b0000;
        }
        .empty .icon { font-size: 2.5em; margin-bottom: 10px; }
        .empty p { font-size: 0.92em; }
        .empty b { color: #ff1493; }

        /* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(80px);
            background: #e0446d;
            color: #fff;
            padding: 10px 22px;
            border-radius: 8px;
            font-size: 0.88em;
            font-weight: 600;
            opacity: 0;
            transition: all 0.25s ease;
            z-index: 100;
        }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <div class="profile-avatar" id="profileAvatar">
            <img src="https://picsum.photos/seed/default/100/100.jpg" alt="Profile" id="profilePicImg">
        </div>
        <div class="profile-info">
            <h3 id="profileName">Anonymous User</h3>
            <p id="profileHandle">@anon_user</p>
        </div>
    </div>
    
    <div class="sidebar-menu">
        <button class="sidebar-item" onclick="editProfile()">
            <span class="sidebar-icon">‚úèÔ∏è</span>
            <span>Edit Profile</span>
        </button>
        <button class="sidebar-item" onclick="changeProfilePicture()">
            <span class="sidebar-icon">üì∑</span>
            <span>Change Profile Picture</span>
        </button>
        <button class="sidebar-item" onclick="viewMyPosts()">
            <span class="sidebar-icon">üìù</span>
            <span>My Posts</span>
        </button>
        <button class="sidebar-item" onclick="viewSettings()">
            <span class="sidebar-icon">‚öôÔ∏è</span>
            <span>Settings</span>
        </button>
        <div class="sidebar-divider"></div>
        <button class="sidebar-item logout-btn" onclick="logout()">
            <span class="sidebar-icon">üö™</span>
            <span>Log Out</span>
        </button>
    </div>
</div>

<!-- Sidebar Toggle Button -->
<button class="sidebar-toggle" onclick="toggleSidebar()" id="sidebarToggle">
    <span>‚ò∞</span>
</button>

<div class="timeline">
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="top-bar-inner">
            <h1>Campus Confessions <span class="subtitle" id="count"></span></h1>
            <div class="search-container">
                <input type="text" id="nameLookup" placeholder="Search by post ID or user name..." oninput="handleSearchInput(event)" onkeypress="handleNameLookupEnter(event)">
                <button onclick="lookupName()" class="search-btn">üîç</button>
                <div class="search-dropdown" id="searchDropdown" style="display: none;">
                    <div class="search-options">
                        <button class="search-option" onclick="setSearchType('id')">
                            <span class="search-option-icon">üî¢</span>
                            <span>Search by Post ID</span>
                        </button>
                        <button class="search-option" onclick="setSearchType('name')">
                            <span class="search-option-icon">üë§</span>
                            <span>Search by User Name</span>
                        </button>
                    </div>
                </div>
            </div>
            <button class="dark-mode-toggle" onclick="toggleDarkMode()" id="darkModeToggle">
                <span class="dark-mode-icon">üåô</span>
                <span class="light-mode-icon" style="display: none;">‚òÄÔ∏è</span>
            </button>
        </div>
        <div class="tabs">
            <button class="tab active" onclick="switchTab('new', this)">üÜï New</button>
            <button class="tab" onclick="switchTab('rising', this)">üìà Rising</button>
            <button class="tab" onclick="switchTab('controversial', this)">‚ö° Controversial</button>
            <button class="tab" onclick="switchTab('top', this)">üî• Top</button>
            <button class="tab" onclick="switchTab('best', this)">‚≠ê Best</button>
            <button class="tab" onclick="switchTab('hot', this)">üåã Hot</button>
        </div>
    </div>

    <!-- Compose -->
    <div class="compose">
        <div class="avatar compose-avatar">?</div>
        <div class="compose-body">
            <textarea id="input" placeholder="What's happening on campus?" maxlength="280" rows="2"></textarea>
            <div class="compose-moods" id="moods">
                <span class="mood-chip" data-mood="love" onclick="pickMood(this)">&#10084;&#65039; love</span>
                <span class="mood-chip" data-mood="happy" onclick="pickMood(this)">&#128522; happy</span>
                <span class="mood-chip" data-mood="sad" onclick="pickMood(this)">&#128546; sad</span>
                <span class="mood-chip" data-mood="angry" onclick="pickMood(this)">&#128545; angry</span>
                <span class="mood-chip" data-mood="anxious" onclick="pickMood(this)">&#128560; anxious</span>
                <span class="mood-chip" data-mood="excited" onclick="pickMood(this)">&#128293; excited</span>
            </div>
            <div class="image-preview-container" id="imagePreviewContainer" style="display: none;">
                <div class="image-preview">
                    <img id="previewImage" src="" alt="Preview">
                    <button type="button" class="remove-image-btn" onclick="removeImage()">‚úï</button>
                </div>
            </div>
            <div class="compose-footer">
                <div class="compose-left">
                    <label for="imageUpload" class="image-upload-btn">
                        üì∑ Image
                    </label>
                    <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="previewImage(event)">
                    <div class="char-ring" id="charRing">
                        <svg width="28" height="28" viewBox="0 0 28 28">
                            <circle class="bg" cx="14" cy="14" r="11" />
                            <circle class="fill" cx="14" cy="14" r="11" stroke-dasharray="69.12" stroke-dashoffset="69.12" />
                        </svg>
                    </div>
                </div>
                <button class="post-btn" id="postBtn" onclick="createPost()" disabled>Post</button>
            </div>
        </div>
    </div>

    <!-- Feed -->
    <div id="feed"></div>
</div>

<div class="toast" id="toast"></div>

<script>
const API = '/api/posts';
const MAX = 280;
const CIRCUMFERENCE = 2 * Math.PI * 11; // ~69.12

const input = document.getElementById('input');
const postBtn = document.getElementById('postBtn');
const fillCircle = document.querySelector('.char-ring .fill');

let mood = 'none';
let sort = 'new';
const liked = new Set();
const reposted = new Set();
const bookmarked = new Set();
const reacted = {}; // { postId: Set<type> }
let selectedImage = null;
const replyImages = {}; // Store reply images by post ID

// ‚îÄ‚îÄ Dark Mode Toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function toggleDarkMode() {
    const body = document.body;
    const darkModeToggle = document.getElementById('darkModeToggle');
    const darkIcon = darkModeToggle.querySelector('.dark-mode-icon');
    const lightIcon = darkModeToggle.querySelector('.light-mode-icon');
    
    body.classList.toggle('dark-mode');
    
    if (body.classList.contains('dark-mode')) {
        darkIcon.style.display = 'none';
        lightIcon.style.display = 'inline';
        localStorage.setItem('darkMode', 'enabled');
    } else {
        darkIcon.style.display = 'inline';
        lightIcon.style.display = 'none';
        localStorage.setItem('darkMode', 'disabled');
    }
}

// Check for saved dark mode preference
function initDarkMode() {
    const savedDarkMode = localStorage.getItem('darkMode');
    if (savedDarkMode === 'enabled') {
        document.body.classList.add('dark-mode');
        const darkModeToggle = document.getElementById('darkModeToggle');
        if (darkModeToggle) {
            darkModeToggle.querySelector('.dark-mode-icon').style.display = 'none';
            darkModeToggle.querySelector('.light-mode-icon').style.display = 'inline';
        }
    }
}

// Initialize dark mode on page load
initDarkMode();

// ‚îÄ‚îÄ Sidebar Functions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const toggle = document.getElementById('sidebarToggle');
    
    sidebar.classList.toggle('open');
    
    if (sidebar.classList.contains('open')) {
        toggle.innerHTML = '<span>‚úï</span>';
    } else {
        toggle.innerHTML = '<span>‚ò∞</span>';
    }
}

function editProfile() {
    // Simulate profile editing
    const currentName = document.getElementById('profileName').textContent;
    const newName = prompt('Enter your display name:', currentName);
    
    if (newName && newName.trim() && newName !== currentName) {
        document.getElementById('profileName').textContent = newName.trim();
        localStorage.setItem('profileName', newName.trim());
        toast('Profile updated successfully!');
    }
}

function changeProfilePicture() {
    // Create file input for profile picture
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    input.onchange = function(e) {
        const file = e.target.files[0];
        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const imgData = e.target.result;
                document.getElementById('profilePicImg').src = imgData;
                localStorage.setItem('profilePicture', imgData);
                toast('Profile picture updated!');
            };
            reader.readAsDataURL(file);
        }
    };
    input.click();
}

function viewMyPosts() {
    // Filter to show only user's posts (simulated)
    const userPosts = []; // This would normally filter by user ID
    toast('My posts feature coming soon!');
}

function viewSettings() {
    toast('Settings panel coming soon!');
}

function logout() {
    if (confirm('Are you sure you want to log out?')) {
        // Clear local storage
        localStorage.removeItem('profileName');
        localStorage.removeItem('profilePicture');
        localStorage.removeItem('darkMode');
        
        // Reset profile
        document.getElementById('profileName').textContent = 'Anonymous User';
        document.getElementById('profileHandle').textContent = '@anon_user';
        document.getElementById('profilePicImg').src = 'https://picsum.photos/seed/default/100/100.jpg';
        
        // Reset to light mode
        document.body.classList.remove('dark-mode');
        const darkModeToggle = document.getElementById('darkModeToggle');
        darkModeToggle.querySelector('.dark-mode-icon').style.display = 'inline';
        darkModeToggle.querySelector('.light-mode-icon').style.display = 'none';
        
        // Close sidebar
        toggleSidebar();
        
        toast('Logged out successfully!');
        
        // In a real app, this would redirect to login page
        setTimeout(() => {
            location.reload();
        }, 1500);
    }
}

// Load saved profile data
function loadProfile() {
    const savedName = localStorage.getItem('profileName');
    const savedPicture = localStorage.getItem('profilePicture');
    
    if (savedName) {
        document.getElementById('profileName').textContent = savedName;
        document.getElementById('profileHandle').textContent = '@' + savedName.toLowerCase().replace(/\s+/g, '_');
    }
    
    if (savedPicture) {
        document.getElementById('profilePicImg').src = savedPicture;
    }
}

// Initialize profile on page load
loadProfile();

// ‚îÄ‚îÄ Report Functions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

let currentReportType = null;
let currentReportId = null;
let selectedReason = null;

function showReportTooltip(type, id, button) {
    // Hide all other tooltips first
    document.querySelectorAll('.report-tooltip').forEach(tooltip => {
        tooltip.classList.remove('show');
    });
    
    // Reset state
    currentReportType = type;
    currentReportId = id;
    selectedReason = null;
    
    // Show current tooltip
    const tooltip = document.getElementById(`report-tooltip-${type}-${id}`);
    if (tooltip) {
        tooltip.classList.add('show');
    }
}

function hideReportTooltip(button) {
    const tooltip = button.nextElementSibling;
    if (tooltip && tooltip.classList.contains('report-tooltip')) {
        tooltip.classList.remove('show');
    }
}

function selectReportReason(type, id, reason) {
    selectedReason = reason;
    
    // Hide the custom section if "Other" is not selected
    const customSection = document.getElementById(`custom-section-${type}-${id}`);
    if (reason === 'other') {
        customSection.style.display = 'block';
        // Focus on textarea
        setTimeout(() => {
            const textarea = document.getElementById(`custom-input-${type}-${id}`);
            if (textarea) textarea.focus();
        }, 100);
    } else {
        customSection.style.display = 'none';
        // Submit immediately for predefined reasons
        submitReport(type, id);
    }
}

function cancelReport(type, id) {
    // Hide the custom section
    const customSection = document.getElementById(`custom-section-${type}-${id}`);
    if (customSection) {
        customSection.style.display = 'none';
    }
    
    // Clear the textarea
    const textarea = document.getElementById(`custom-input-${type}-${id}`);
    if (textarea) {
        textarea.value = '';
    }
    
    // Hide tooltip
    const tooltip = document.getElementById(`report-tooltip-${type}-${id}`);
    if (tooltip) {
        tooltip.classList.remove('show');
    }
}

function submitReport(type, id) {
    let reportReason = selectedReason;
    let customDescription = '';
    
    // If "Other" is selected, get custom description
    if (selectedReason === 'other') {
        const textarea = document.getElementById(`custom-input-${type}-${id}`);
        if (textarea) {
            customDescription = textarea.value.trim();
            if (!customDescription) {
                toast('Please describe the issue before submitting');
                return;
            }
        }
        reportReason = `Other: ${customDescription}`;
    }
    
    // Hide tooltip
    const tooltip = document.getElementById(`report-tooltip-${type}-${id}`);
    if (tooltip) {
        tooltip.classList.remove('show');
    }
    
    // Log the report (in a real app, this would send to server)
    console.log(`Report submitted:`, {
        type: type,
        id: id,
        reason: reportReason,
        timestamp: new Date().toISOString()
    });
    
    // Show confirmation
    const typeText = type === 'post' ? 'Post' : 'Reply';
    toast(`${typeText} reported successfully!`);
    
    // In a real implementation, you would send this to your backend:
    // fetch('/api/report', {
    //     method: 'POST',
    //     headers: { 'Content-Type': 'application/json' },
    //     body: JSON.stringify({
    //         type: type,
    //         id: id,
    //         reason: reportReason
    //     })
    // });
    
    // Reset state
    currentReportType = null;
    currentReportId = null;
    selectedReason = null;
}

// ‚îÄ‚îÄ Enhanced Search Functions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

let searchType = 'id'; // 'id' or 'name'
let searchTimeout = null;
let allPosts = []; // Store all posts for searching

function handleSearchInput(event) {
    const input = event.target;
    const value = input.value.trim();
    
    // Clear existing timeout
    if (searchTimeout) {
        clearTimeout(searchTimeout);
    }
    
    // Show/hide dropdown based on input
    const dropdown = document.getElementById('searchDropdown');
    if (value.length > 0) {
        dropdown.style.display = 'block';
        
        // Debounced search
        searchTimeout = setTimeout(() => {
            performSearch(value);
        }, 300);
    } else {
        dropdown.style.display = 'none';
        // Reset to show all posts
        displayAllPosts();
    }
}

function setSearchType(type) {
    searchType = type;
    const input = document.getElementById('nameLookup');
    const dropdown = document.getElementById('searchDropdown');
    
    // Update placeholder
    if (type === 'id') {
        input.placeholder = 'Search by post ID...';
        input.type = 'number';
        input.min = '1';
    } else {
        input.placeholder = 'Search by user name...';
        input.type = 'text';
        input.removeAttribute('min');
    }
    
    // Hide dropdown
    dropdown.style.display = 'none';
    
    // Focus input
    input.focus();
    
    // Perform search if there's a value
    if (input.value.trim()) {
        performSearch(input.value.trim());
    }
}

function performSearch(query) {
    if (!query) {
        displayAllPosts();
        return;
    }
    
    if (searchType === 'id') {
        searchByPostId(query);
    } else {
        searchByUserName(query);
    }
}

function searchByPostId(postId) {
    const id = parseInt(postId);
    if (isNaN(id) || id < 1) {
        toast('Please enter a valid post ID');
        return;
    }
    
    // Find and highlight the specific post
    const postElement = document.getElementById(`post-${id}`);
    if (postElement) {
        // Hide all posts
        document.querySelectorAll('.post').forEach(post => {
            post.style.display = 'none';
        });
        
        // Show the searched post
        postElement.style.display = 'block';
        postElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
        
        // Highlight effect
        postElement.style.border = '2px solid #ff1493';
        setTimeout(() => {
            postElement.style.border = '';
        }, 2000);
        
        toast(`Found post #${id}`);
    } else {
        toast(`Post #${id} not found`);
        displayAllPosts();
    }
}

function searchByUserName(userName) {
    if (!userName || userName.length < 2) {
        toast('Please enter at least 2 characters');
        return;
    }
    
    const query = userName.toLowerCase();
    let foundCount = 0;
    
    // Filter posts by user name
    document.querySelectorAll('.post').forEach(post => {
        const postName = post.querySelector('.post-name');
        const postHandle = post.querySelector('.post-handle');
        
        if (postName && postHandle) {
            const name = postName.textContent.toLowerCase();
            const handle = postHandle.textContent.toLowerCase();
            
            if (name.includes(query) || handle.includes(query)) {
                post.style.display = 'block';
                foundCount++;
            } else {
                post.style.display = 'none';
            }
        }
    });
    
    if (foundCount > 0) {
        toast(`Found ${foundCount} post(s) by "${userName}"`);
        
        // Scroll to first result
        const firstVisible = document.querySelector('.post:not([style*="display: none"])');
        if (firstVisible) {
            firstVisible.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    } else {
        toast(`No posts found for "${userName}"`);
        displayAllPosts();
    }
}

function displayAllPosts() {
    document.querySelectorAll('.post').forEach(post => {
        post.style.display = 'block';
    });
}

function handleNameLookupEnter(event) {
    if (event.key === 'Enter') {
        const input = event.target;
        const value = input.value.trim();
        
        if (value) {
            performSearch(value);
        }
    }
}

function lookupName() {
    const input = document.getElementById('nameLookup');
    const value = input.value.trim();
    
    if (!value) {
        toast('Please enter a search term');
        return;
    }
    
    performSearch(value);
}

// Hide dropdown when clicking outside
document.addEventListener('click', function(event) {
    const searchContainer = document.querySelector('.search-container');
    const dropdown = document.getElementById('searchDropdown');
    
    if (!searchContainer.contains(event.target)) {
        dropdown.style.display = 'none';
    }
});

// ‚îÄ‚îÄ Delete Post Function ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function deletePost(postId, button) {
    console.log('Attempting to delete post:', postId);
    
    // Show confirmation dialog
    if (!confirm('Are you sure you want to delete this post? This action cannot be undone.')) {
        console.log('Delete cancelled by user');
        return;
    }
    
    // Disable button during deletion
    button.disabled = true;
    button.innerHTML = '<span>‚è≥</span>';
    
    // Send delete request to server
    fetch(`/api/posts/${postId}`, {
        method: 'DELETE'
    })
    .then(response => {
        console.log('Delete response status:', response.status);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        console.log('Delete success:', data);
        
        // Remove post from DOM with animation
        const postElement = document.getElementById(`post-${postId}`);
        if (postElement) {
            postElement.style.transition = 'all 0.3s ease';
            postElement.style.opacity = '0';
            postElement.style.transform = 'translateX(-100%)';
            
            setTimeout(() => {
                postElement.remove();
                toast('Post deleted successfully');
                
                // Update post count
                updatePostCount();
                
                // Reload posts if no posts left
                if (document.querySelectorAll('.post').length === 0) {
                    loadPosts();
                }
            }, 300);
        }
    })
    .catch(error => {
        console.error('Delete error:', error);
        toast(`Failed to delete post: ${error.message}`);
        
        // Restore button
        button.disabled = false;
        button.innerHTML = '<span>üóëÔ∏è</span>';
    });
}

function updatePostCount() {
    const count = document.querySelectorAll('.post').length;
    const countElement = document.getElementById('count');
    if (countElement) {
        countElement.textContent = count > 0 ? `(${count})` : '';
    }
}

// ‚îÄ‚îÄ Anonymous identity from post id ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

const ANIMALS = ['Panda','Fox','Owl','Cat','Wolf','Bear','Deer','Hawk','Lynx','Dove','Swan','Crow','Frog','Duck','Seal'];
const COLORS = ['#e0446d','#1d9bf0','#00ba7c','#f9a825','#8e24aa','#d84315','#536471','#0d47a1','#ad1457','#2e7d32'];

function anonName(id) { return 'Anon ' + ANIMALS[id % ANIMALS.length]; }
function anonHandle(id) { return '@anon' + id; }
function anonColor(id) { return COLORS[id % COLORS.length]; }
function anonInitial(id) { return ANIMALS[id % ANIMALS.length][0]; }

// ‚îÄ‚îÄ Mood config ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

const MOOD_MAP = {
    love:    { label: '&#10084;&#65039; love',    cls: 'm-love' },
    happy:   { label: '&#128522; happy',   cls: 'm-happy' },
    sad:     { label: '&#128546; sad',     cls: 'm-sad' },
    angry:   { label: '&#128545; angry',   cls: 'm-angry' },
    anxious: { label: '&#128560; anxious', cls: 'm-anxious' },
    excited: { label: '&#128293; excited', cls: 'm-excited' }
};

const EMOJIS = [
    { type: 'love',  icon: '&#10084;&#65039;' },
    { type: 'haha',  icon: '&#128514;' },
    { type: 'sad',   icon: '&#128546;' },
    { type: 'angry', icon: '&#128545;' },
    { type: 'fire',  icon: '&#128293;' }
];

// ‚îÄ‚îÄ Image Handling ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function previewImage(event) {
    const file = event.target.files[0];
    if (file && file.type.startsWith('image/')) {
        if (file.size > 5 * 1024 * 1024) {
            toast('Image size must be less than 5MB');
            event.target.value = '';
            return;
        }
        
        selectedImage = file;
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('previewImage').src = e.target.result;
            document.getElementById('imagePreviewContainer').style.display = 'block';
        };
        reader.readAsDataURL(file);
    }
}

function removeImage() {
    selectedImage = null;
    document.getElementById('imagePreviewContainer').style.display = 'none';
    document.getElementById('previewImage').src = '';
    document.getElementById('imageUpload').value = '';
}

function previewReplyImage(postId, event) {
    const file = event.target.files[0];
    if (file && file.type.startsWith('image/')) {
        if (file.size > 5 * 1024 * 1024) {
            toast('Image size must be less than 5MB');
            event.target.value = '';
            return;
        }
        
        replyImages[postId] = file;
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById(`reply-preview-img-${postId}`).src = e.target.result;
            document.getElementById(`reply-preview-${postId}`).style.display = 'block';
        };
        reader.readAsDataURL(file);
    }
}

function removeReplyImage(postId) {
    delete replyImages[postId];
    document.getElementById(`reply-preview-${postId}`).style.display = 'none';
    document.getElementById(`reply-preview-img-${postId}`).src = '';
    document.getElementById(`reply-image-${postId}`).value = '';
}

// ‚îÄ‚îÄ Mood picker ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function pickMood(el) {
    const m = el.dataset.mood;
    if (mood === m) {
        mood = 'none';
        el.classList.remove('selected');
    } else {
        document.querySelectorAll('.mood-chip').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        mood = m;
    }
}

// ‚îÄ‚îÄ Character ring ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

input.addEventListener('input', () => {
    const len = input.value.length;
    const pct = len / MAX;
    fillCircle.style.strokeDashoffset = CIRCUMFERENCE * (1 - pct);
    fillCircle.className.baseVal = 'fill' + (pct > 0.9 ? (pct >= 1 ? ' limit' : ' warn') : '');
    postBtn.disabled = len === 0 || len > MAX;
    // Auto-resize textarea
    input.style.height = 'auto';
    input.style.height = input.scrollHeight + 'px';
});

input.addEventListener('keydown', (e) => {
    if (e.ctrlKey && e.key === 'Enter' && !postBtn.disabled) {
        e.preventDefault();
        createPost();
    }
});

// ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function switchTab(s, btn) {
    sort = s;
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    btn.classList.add('active');
    loadPosts();
}

// ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function timeAgo(ts) {
    const s = Math.floor((Date.now() - new Date(ts + 'Z')) / 1000);
    if (s < 60) return 'now';
    const m = Math.floor(s / 60);
    if (m < 60) return m + 'm';
    const h = Math.floor(m / 60);
    if (h < 24) return h + 'h';
    const d = Math.floor(h / 24);
    if (d < 7) return d + 'd';
    return new Date(ts + 'Z').toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
}

function esc(t) {
    const d = document.createElement('div');
    d.textContent = t;
    return d.innerHTML;
}

function fmtCount(n) { return n > 0 ? n : ''; }

// ‚îÄ‚îÄ SVG Icons ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

const ICON = {
    reply:    '<svg viewBox="0 0 24 24"><path d="M1.751 10c0-4.42 3.584-8 8.005-8h4.366c4.49 0 8.129 3.64 8.129 8.13 0 2.25-.893 4.34-2.457 5.86l-4.91 4.77a.75.75 0 01-1.134-.506l-.27-1.874a.75.75 0 01.476-.795C16.57 16.57 18.5 14.5 18.5 12c0-2.76-2.24-5-5-5H10c-2.76 0-5 2.24-5 5v.5c0 .28-.22.5-.5.5H2.25a.5.5 0 01-.5-.5V10z"/></svg>',
    repost:   '<svg viewBox="0 0 24 24"><path d="M4.5 3.88l4.432 4.14-1.364 1.46L5.5 7.55V16c0 1.1.896 2 2 2h4v2H7.5c-2.209 0-4-1.79-4-4V7.55L1.432 9.48.068 8.02 4.5 3.88zM16.5 6H12.5V4h4c2.209 0 4 1.79 4 4v8.45l2.068-1.93 1.364 1.46-4.432 4.14-4.432-4.14 1.364-1.46 2.068 1.93V8c0-1.1-.896-2-2-2z"/></svg>',
    like:     '<svg viewBox="0 0 24 24"><path d="M16.697 5.5c-1.222-.06-2.679.51-3.89 2.16l-.805 1.09-.806-1.09C10.001 6.01 8.534 5.44 7.303 5.5c-1.533.09-2.904 1.04-3.49 2.64-.587 1.6-.235 3.46 1.098 5.22 1.333 1.76 3.524 3.59 6.09 5.24 2.564-1.65 4.756-3.48 6.089-5.24 1.333-1.76 1.685-3.62 1.098-5.22-.586-1.6-1.957-2.55-3.49-2.64z"/></svg>',
    bookmark: '<svg viewBox="0 0 24 24"><path d="M4 4.5C4 3.12 5.119 2 6.5 2h11C18.881 2 20 3.12 20 4.5v18.44l-8-5.71-8 5.71V4.5z"/></svg>'
};

// ‚îÄ‚îÄ Load Posts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

async function loadPosts() {
    try {
        const res = await fetch(`${API}?sort=${sort}`);
        const posts = await res.json();
        const feed = document.getElementById('feed');
        document.getElementById('count').textContent = posts.length ? `\u00b7 ${posts.length} posts` : '';

        if (!posts.length) {
            feed.innerHTML = '<div class="empty"><div class="icon">&#128172;</div><p><b>No confessions yet.</b><br>Be the first to post.</p></div>';
            return;
        }

        feed.innerHTML = posts.map(p => {
            const moodHtml = p.mood && p.mood !== 'none' && MOOD_MAP[p.mood]
                ? `<span class="post-mood ${MOOD_MAP[p.mood].cls}">${MOOD_MAP[p.mood].label}</span>` : '';

            const imageHtml = p.image ? `
                <div class="post-image">
                    <img src="${p.image}" alt="Post image" loading="lazy">
                </div>
            ` : '';

            const emojisHtml = EMOJIS.map(e => {
                const c = (p.reactions && p.reactions[e.type]) || 0;
                const done = reacted[p.id] && reacted[p.id].has(e.type);
                return `<button class="emoji-btn ${done ? 'reacted' : ''}" onclick="react(${p.id},'${e.type}',this)">${e.icon}${c ? '<span class="e-count">'+c+'</span>' : ''}</button>`;
            }).join('');

            return `
            <div class="post" id="post-${p.id}">
                <div class="avatar" style="background:${anonColor(p.id)}">${anonInitial(p.id)}</div>
                <div class="post-body">
                    <div class="post-header">
                        <span class="post-name">${anonName(p.id)}</span>
                        <span class="post-handle">${anonHandle(p.id)}</span>
                        <span class="post-dot">&middot;</span>
                        <span class="post-time">${timeAgo(p.timestamp)}</span>
                        <div class="post-actions">
                            <button class="post-action-btn delete-btn" onclick="deletePost(${p.id}, this)" title="Delete post">
                                <span>üóëÔ∏è</span>
                            </button>
                            <div class="report-container">
                                <button class="report-btn" onclick="showReportTooltip('post', ${p.id}, this)" onmouseleave="hideReportTooltip(this)">
                                    <span class="report-icon">üö©</span>
                                </button>
                                <div class="report-tooltip" id="report-tooltip-post-${p.id}">
                                    <div class="report-tooltip-content">
                                        <h4>Report Post</h4>
                                        <div class="report-options">
                                            <button onclick="selectReportReason('post', ${p.id}, 'spam')">üìß Spam</button>
                                            <button onclick="selectReportReason('post', ${p.id}, 'inappropriate')">‚ö†Ô∏è Inappropriate</button>
                                            <button onclick="selectReportReason('post', ${p.id}, 'harassment')">üõë Harassment</button>
                                            <button onclick="selectReportReason('post', ${p.id}, 'misinformation')">‚ùå Misinformation</button>
                                            <button onclick="selectReportReason('post', ${p.id}, 'other')">üìã Other</button>
                                        </div>
                                        <div class="report-custom-section" id="custom-section-post-${p.id}" style="display: none;">
                                            <textarea 
                                                id="custom-input-post-${p.id}" 
                                                placeholder="Please describe the issue in detail..." 
                                                maxlength="500"
                                                rows="3"
                                            ></textarea>
                                            <div class="report-actions">
                                                <button class="report-cancel-btn" onclick="cancelReport('post', ${p.id})">Cancel</button>
                                                <button class="report-submit-btn" onclick="submitReport('post', ${p.id})">Submit Report</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    ${moodHtml}
                    <div class="post-text">${esc(p.text)}</div>
                    ${imageHtml}
                    <div class="post-reactions">${emojisHtml}</div>
                    <div class="actions">
                        <button class="action reply-action" onclick="toggleReplies(${p.id})">
                            ${ICON.reply} <span>${fmtCount(p.reply_count)}</span>
                        </button>
                        <button class="action repost-action ${reposted.has(p.id)?'reposted':''}" onclick="doRepost(${p.id},this)">
                            ${ICON.repost} <span>${fmtCount(p.reposts)}</span>
                        </button>
                        <button class="action like-action ${liked.has(p.id)?'liked':''}" onclick="doLike(${p.id},this)">
                            ${ICON.like} <span>${fmtCount(p.likes)}</span>
                        </button>
                        <button class="action bookmark-action ${bookmarked.has(p.id)?'bookmarked':''}" onclick="doBookmark(${p.id},this)">
                            ${ICON.bookmark}
                        </button>
                    </div>
                    <div class="replies-section" id="replies-${p.id}">
                        <div id="replies-list-${p.id}"></div>
                        <div class="reply-compose">
                            <input type="text" id="reply-input-${p.id}" placeholder="Post your reply" maxlength="280" onkeydown="if(event.key==='Enter')sendReply(${p.id})" />
                            <label for="reply-image-${p.id}" class="reply-image-btn">üì∑</label>
                            <input type="file" id="reply-image-${p.id}" accept="image/*" style="display: none;" onchange="previewReplyImage(${p.id}, event)">
                            <button onclick="sendReply(${p.id})">Reply</button>
                        </div>
                        <div class="reply-image-preview-container" id="reply-preview-${p.id}" style="display: none;">
                            <div class="reply-image-preview">
                                <img id="reply-preview-img-${p.id}" src="" alt="Reply preview">
                                <button type="button" class="remove-reply-image-btn" onclick="removeReplyImage(${p.id})">‚úï</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
        }).join('');
    } catch (e) {
        console.error('Load failed:', e);
    }
}

// ‚îÄ‚îÄ Create Post ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

async function createPost() {
    const text = input.value.trim();
    if (!text) return;
    
    postBtn.disabled = true;
    
    const formData = new FormData();
    formData.append('text', text);
    formData.append('mood', mood);
    if (selectedImage) {
        formData.append('image', selectedImage);
    }
    
    try {
        const response = await fetch(API, {
            method: 'POST',
            body: formData
        });
        
        if (!response.ok) {
            const error = await response.json();
            throw new Error(error.error || 'Failed to post');
        }
        
        input.value = '';
        input.style.height = 'auto';
        fillCircle.style.strokeDashoffset = CIRCUMFERENCE;
        fillCircle.className.baseVal = 'fill';
        mood = 'none';
        selectedImage = null;
        removeImage();
        document.querySelectorAll('.mood-chip').forEach(c => c.classList.remove('selected'));
        toast('Posted!');
        loadPosts();
    } catch (e) { 
        toast(e.message || 'Failed to post'); 
    } finally {
        postBtn.disabled = false;
    }
}

// ‚îÄ‚îÄ Like ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

async function doLike(id, btn) {
    if (liked.has(id)) return;
    liked.add(id);
    btn.classList.add('liked');
    try {
        const res = await fetch(`${API}/${id}/like`, { method: 'POST' });
        const data = await res.json();
        btn.querySelector('span').textContent = fmtCount(data.likes);
    } catch (e) {
        liked.delete(id);
        btn.classList.remove('liked');
    }
}

// ‚îÄ‚îÄ Repost ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

async function doRepost(id, btn) {
    if (reposted.has(id)) return;
    reposted.add(id);
    btn.classList.add('reposted');
    try {
        const res = await fetch(`${API}/${id}/repost`, { method: 'POST' });
        const data = await res.json();
        btn.querySelector('span').textContent = fmtCount(data.reposts);
        toast('Reposted!');
    } catch (e) {
        reposted.delete(id);
        btn.classList.remove('reposted');
    }
}

// ‚îÄ‚îÄ Bookmark (client-side only) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function doBookmark(id, btn) {
    if (bookmarked.has(id)) {
        bookmarked.delete(id);
        btn.classList.remove('bookmarked');
        toast('Removed from bookmarks');
    } else {
        bookmarked.add(id);
        btn.classList.add('bookmarked');
        toast('Added to bookmarks');
    }
}

// ‚îÄ‚îÄ Reactions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

async function react(id, type, btn) {
    if (!reacted[id]) reacted[id] = new Set();
    if (reacted[id].has(type)) return;
    reacted[id].add(type);
    btn.classList.add('reacted');
    try {
        const res = await fetch(`${API}/${id}/react`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ type })
        });
        const data = await res.json();
        const c = (data.reactions && data.reactions[type]) || 0;
        const countEl = btn.querySelector('.e-count');
        if (countEl) countEl.textContent = c;
        else if (c) btn.insertAdjacentHTML('beforeend', `<span class="e-count">${c}</span>`);
    } catch (e) {
        reacted[id].delete(type);
        btn.classList.remove('reacted');
    }
}

// ‚îÄ‚îÄ Replies ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function toggleReplies(id) {
    const sec = document.getElementById(`replies-${id}`);
    if (sec.classList.contains('open')) { sec.classList.remove('open'); return; }
    sec.classList.add('open');
    fetchReplies(id);
}

async function fetchReplies(id) {
    try {
        const res = await fetch(`${API}/${id}/replies`);
        const replies = await res.json();
        const list = document.getElementById(`replies-list-${id}`);
        if (!replies.length) {
            list.innerHTML = '<div style="padding:10px 0 0 52px;color:#9aa3ad;font-size:0.85em;">No replies yet</div>';
        } else {
            list.innerHTML = replies.map(r => {
                const imageHtml = r.image ? `
                    <div class="reply-image">
                        <img src="${r.image}" alt="Reply image" loading="lazy">
                    </div>
                ` : '';
                
                return `
                <div class="reply">
                    <div class="reply-avatar">${anonInitial(r.id)}</div>
                    <div class="reply-body">
                        <span class="reply-name">${anonName(r.id)}</span>
                        <span class="reply-handle">${anonHandle(r.id)}</span>
                        <div class="reply-text">${esc(r.text)}</div>
                        ${imageHtml}
                        <div class="reply-time">${timeAgo(r.timestamp)}</div>
                        <div class="report-container">
                            <button class="report-btn reply-report-btn" onclick="showReportTooltip('reply', ${r.id}, this)" onmouseleave="hideReportTooltip(this)">
                                <span class="report-icon">üö©</span>
                            </button>
                            <div class="report-tooltip" id="report-tooltip-reply-${r.id}">
                                <div class="report-tooltip-content">
                                    <h4>Report Reply</h4>
                                    <div class="report-options">
                                        <button onclick="selectReportReason('reply', ${r.id}, 'spam')">üìß Spam</button>
                                        <button onclick="selectReportReason('reply', ${r.id}, 'inappropriate')">‚ö†Ô∏è Inappropriate</button>
                                        <button onclick="selectReportReason('reply', ${r.id}, 'harassment')">üõë Harassment</button>
                                        <button onclick="selectReportReason('reply', ${r.id}, 'misinformation')">‚ùå Misinformation</button>
                                        <button onclick="selectReportReason('reply', ${r.id}, 'other')">üìã Other</button>
                                    </div>
                                    <div class="report-custom-section" id="custom-section-reply-${r.id}" style="display: none;">
                                        <textarea 
                                            id="custom-input-reply-${r.id}" 
                                            placeholder="Please describe the issue in detail..." 
                                            maxlength="500"
                                            rows="3"
                                        ></textarea>
                                        <div class="report-actions">
                                            <button class="report-cancel-btn" onclick="cancelReport('reply', ${r.id})">Cancel</button>
                                            <button class="report-submit-btn" onclick="submitReport('reply', ${r.id})">Submit Report</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            }).join('');
        }
    } catch (e) { console.error(e); }
}

async function sendReply(id) {
    const inp = document.getElementById(`reply-input-${id}`);
    const text = inp.value.trim();
    if (!text) return;
    
    const formData = new FormData();
    formData.append('text', text);
    if (replyImages[id]) {
        formData.append('image', replyImages[id]);
    }
    
    try {
        const response = await fetch(`${API}/${id}/reply`, {
            method: 'POST',
            body: formData
        });
        
        if (!response.ok) {
            const error = await response.json();
            throw new Error(error.error || 'Failed to reply');
        }
        
        inp.value = '';
        removeReplyImage(id);
        await fetchReplies(id);
        // Update reply count in action bar
        const res = await fetch(`${API}/${id}/replies`);
        const replies = await res.json();
        const postEl = document.getElementById(`post-${id}`);
        const replyBtn = postEl.querySelector('.reply-action span');
        replyBtn.textContent = fmtCount(replies.length);
        toast('Reply posted!');
    } catch (e) { 
        toast(e.message || 'Failed to reply'); 
    }
}

// ‚îÄ‚îÄ Toast ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function toast(msg) {
    const el = document.getElementById('toast');
    el.textContent = msg;
    el.classList.add('show');
    setTimeout(() => el.classList.remove('show'), 2200);
}

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
loadPosts();
</script>
</body>
</html>
